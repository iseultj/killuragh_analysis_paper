rm(list=ls())
library(tidyverse)
library(vegan)
library(reshape2)
library(pheatmap)
meta_csv <- '/home/iseult/Desktop/Killuragh/metatax_may_23/sample_metadata_killuragh_3-6-22.forR.tsv'
taxid_dat <- '/home/iseult/Desktop/Killuragh/metagenomics/updated_metatax_dataset_25-4-22/taxid_to_name.csv'
species_tab <- '/home/iseult/Desktop/Killuragh/metatax_may_23/killuragh_teeth.dental_data_with_sources.25-04-22.species.tsv'
meta <- read.csv(meta_csv, sep='\t')
taxnames <- read.csv(taxid_dat,header=F)
colnames(taxnames) <- c("TAXID","Scientific_name","V3","V4","V5")
# remove unnecessary columns
taxnames['V3'] <- NULL
taxnames['V4'] <- NULL
taxnames['V5'] <- NULL
## Species level data
species_kraken <- read.csv(species_tab, sep='\t')
## convert raw counts to relative abundance
rownames(species_kraken) <- species_kraken$TAXID
species_kraken <- species_kraken[,-1]
MS <- as.matrix(species_kraken)
MS_filt <- MS[,colSums(MS)>1000000]
MS1 <- sweep(MS_filt,2,colSums(MS_filt),"/")
MS1[MS1 < 0.00003] <- 0
#get rid of rows with no counts left after filtering
MS1 <- MS1[rowSums(MS1[,-1])>0,]
norm_sp <- data.frame(TAXID = row.names(MS1), MS1)
norm_sp_names <- merge(norm_sp,taxnames)
norm_sp_names['TAXID'] <- NULL
melt_sp <- melt(norm_sp_names)
colnames(melt_sp) <- c("Species", "ID","Proportion")
# pathobionts
path_all <- melt_sp %>% filter(grepl("Streptococcus_mutans|Tannerella_forsythia|Treponema_denticola|Porphyromonas_gingivalis|Fusobacterium_nucleatum", Species))
# create matrix
pathM <- acast(path_all, ID~Species, value.var="Proportion")
# write this to a csv so you have a table
write.csv(pathM, "~/Desktop/relative_abundance_pathobionts.1M_read_threshold.csv")
head(pathM)
rownames(pathM)
pathM$ID <- rownames(pathM)
View(pathM)
# create matrix
pathM <- acast(path_all, ID~Species, value.var="Proportion")
as.data.frame(pathM)
pathM <- as.data.frame(pathM)
pathM$ID <- rownames(pathM)
View(pathM)
head(mets)
head(meta)
merge(pathM,meta)
pathM <- merge(pathM,meta)
head(pathM)
colnames(pathM)
pathM %>% select("ID","Fusobacterium_nucleatum","Porphyromonas_gingivalis","Streptococcus_mutans","Tannerella_forsythia","Treponema_denticola","Read_Depth","SampleSource" )
pathM <- pathM %>% select("ID","Fusobacterium_nucleatum","Porphyromonas_gingivalis","Streptococcus_mutans","Tannerella_forsythia","Treponema_denticola","Read_Depth","SampleSource" )
# write this to a csv so you have a table
write.csv(pathM, "~/Desktop/relative_abundance_pathobionts.1M_read_threshold.csv")
